<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Concurrency Issues Summary</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
  <style>
    #downloadCsv { display: none; }
    body{font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#ffffff; color:#222; padding:28px;}
    .container{max-width:1100px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    p.lead{margin:6px 0 0;color:#555;font-size:13px}
    .card{background:#fff;border-radius:12px;padding:18px;box-shadow:0 2px 8px rgba(0,0,0,0.1);border:1px solid #ddd}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .controls input[type="search"]{padding:8px 12px;border-radius:8px;border:1px solid #ccc;color:#222;width: 4000px;max-width: 28%;}
    .controls button{padding:8px 12px;border-radius:8px;border:1px solid #ccc;background:#f0f0f0;color:#000;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    thead th{position:sticky;top:0;background:#f8f8f8;padding:10px;text-align:left;font-size:13px;border-bottom:1px solid #ddd}
    th.sortable{cursor:pointer}
    tbody td{padding:10px;font-size:13px;border-bottom:1px solid #eee}
    tbody tr:nth-child(odd){background:#fff}
    tbody tr:nth-child(even){background:#f9f9f9}
    tfoot td{font-weight:700;padding:10px;border-top:2px solid #ccc;background:#f0f0f0}
    .muted{color:#777;font-size:12px}
    .chart-wrap{margin-top:18px}
    @media (max-width:820px){ thead{display:none} table, tbody, tr, td{display:block;width:100%} tr{margin-bottom:10px} td{padding:8px;position:relative} td::before{content:attr(data-label);display:block;font-weight:600;color:#555;margin-bottom:6px} tfoot td{display:block} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>CONCUR â€” JPF Report in Pass@1</h1>
        <p class="lead">This table shows concurrency-related issues across LLMs.</p>
      </div>
      <a href="./leaderboard.html" class="muted">CONCUR</a>
    </header>

    <section class="card">
      <div class="controls">
        <input id="search" type="search" placeholder="Search model name (e.g. gpt-5)" />
        <button id="downloadCsv">Download CSV</button>
        <button id="toggleChart">Toggle Chart / Table</button>
      </div>

      <div id="tableWrap">
        <table id="dataTable" aria-label="Concurrency summary table">
          <thead>
            <tr>
              <th class="sortable" data-key="Model">Model</th>
              <th class="sortable" data-key="Deadlock">Deadlock</th>
              <th class="sortable" data-key="RuntimeException">Uncaught Exception</th>
              <th class="sortable" data-key="NoEntryMethod">No Entry Method</th>
              <th class="sortable" data-key="SingleThread">Single Thread</th>
              <th class="sortable" data-key="TerminationError">Termination Error</th>
              <th class="sortable" data-key="RaceCondition">Race Condition</th>

            </tr>
          </thead>
          <tbody id="tbody"></tbody>
          <tfoot>
            <tr id="totalsRow"></tr>
          </tfoot>
        </table>
      </div>

      <div id="chartWrap" class="chart-wrap" style="display:none">
        <canvas id="stackedChart" height="500"></canvas>
      </div>
    </section>

    <footer style="margin-top:14px;color:#777;font-size:13px">Tip: Upload this file to your repository and enable GitHub Pages to publish it.</footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script>
    const rows = [
      {Model:'claude-opus-4-1', Deadlock:1, RuntimeException:14, NoEntryMethod:0, SingleThread:0, TerminationError:0},
      {Model:'codellama:34b', Deadlock:1, RuntimeException:1, NoEntryMethod:6, SingleThread:0, TerminationError:0},
      {Model:'codeqwen:7b', Deadlock:2, RuntimeException:4, NoEntryMethod:4, SingleThread:0, TerminationError:0},
      {Model:'codestral:22b', Deadlock:1, RuntimeException:2, NoEntryMethod:2, SingleThread:0, TerminationError:3},
      {Model:'deepseek-r1:32b', Deadlock:0, RuntimeException:3, NoEntryMethod:0, SingleThread:0, TerminationError:6},
      {Model:'dolphin3:8b', Deadlock:3, RuntimeException:1, NoEntryMethod:0, SingleThread:0, TerminationError:1},
      {Model:'gemma2:27b', Deadlock:1, RuntimeException:6, NoEntryMethod:0, SingleThread:0, TerminationError:1},
      {Model:'gpt-4o', Deadlock:1, RuntimeException:9, NoEntryMethod:0, SingleThread:0, TerminationError:0},
      {Model:'gpt-5', Deadlock:1, RuntimeException:5, NoEntryMethod:0, SingleThread:0, TerminationError:0},
      {Model:'llama3.3:70b', Deadlock:1, RuntimeException:3, NoEntryMethod:1, SingleThread:0, TerminationError:1},
      {Model:'llava:34b', Deadlock:0, RuntimeException:0, NoEntryMethod:0, SingleThread:0, TerminationError:1},
      {Model:'magicoder:7b', Deadlock:2, RuntimeException:0, NoEntryMethod:2, SingleThread:2, TerminationError:2},
      {Model:'mistral:7b', Deadlock:0, RuntimeException:3, NoEntryMethod:1, SingleThread:0, TerminationError:2},
      {Model:'mixtral:8x7b', Deadlock:0, RuntimeException:4, NoEntryMethod:0, SingleThread:0, TerminationError:8},
      {Model:'opencoder:8b', Deadlock:2, RuntimeException:1, NoEntryMethod:1, SingleThread:0, TerminationError:4},
      {Model:'phi4:14b', Deadlock:2, RuntimeException:1, NoEntryMethod:0, SingleThread:0, TerminationError:0},
      {Model:'phind-codellama:34b', Deadlock:0, RuntimeException:6, NoEntryMethod:2, SingleThread:2, TerminationError:2},
      {Model:'qwen3:32b', Deadlock:0, RuntimeException:1, NoEntryMethod:0, SingleThread:0, TerminationError:11},
      {Model:'starcoder2:15b', Deadlock:0, RuntimeException:0, NoEntryMethod:2, SingleThread:4, TerminationError:0},
      {Model:'vicuna:33b', Deadlock:0, RuntimeException:2, NoEntryMethod:1, SingleThread:0, TerminationError:0},
      {Model:'wizardcoder:33b', Deadlock:2, RuntimeException:6, NoEntryMethod:0, SingleThread:1, TerminationError:5},
      {Model:'zephyr:7b', Deadlock:0, RuntimeException:1, NoEntryMethod:0, SingleThread:0, TerminationError:0},
    ];

    const totals = {Deadlock:20, RuntimeException:73, NoEntryMethod:22, SingleThread:9, TerminationError:47};

    const tbody = document.getElementById('tbody');
    function renderRows(filterText = '', sortKey = null, sortDesc = false){
  tbody.innerHTML = '';
  let data = rows.filter(r => r.Model.toLowerCase().includes(filterText.toLowerCase()));

  if(sortKey){
    data.sort((a,b)=>{
      const va = (typeof a[sortKey]==='string')?a[sortKey].toLowerCase():a[sortKey];
      const vb = (typeof b[sortKey]==='string')?b[sortKey].toLowerCase():b[sortKey];
      if(va<vb) return sortDesc?1:-1;
      if(va>vb) return sortDesc?-1:1;
      return 0;
    });
  }

  data.forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td data-label="Model">${escapeHtml(r.Model)}</td>
      <td data-label="Deadlock">${r.Deadlock}</td>
      <td data-label="Runtime Exception">${r.RuntimeException}</td>
      <td data-label="No Entry Method">${r.NoEntryMethod}</td>
      <td data-label="Single Thread">${r.SingleThread}</td>
      <td data-label="Termination Error">${r.TerminationError}</td>
      <td data-label="Race Condition">0</td>
    `;
    tbody.appendChild(tr);
  });

  const totalDeadlock = data.reduce((sum, r) => sum + r.Deadlock, 0);
  const totalRuntimeException = data.reduce((sum, r) => sum + r.RuntimeException, 0);
  const totalNoEntryMethod = data.reduce((sum, r) => sum + r.NoEntryMethod, 0);
  const totalSingleThread = data.reduce((sum, r) => sum + r.SingleThread, 0);
  const totalTerminationError = data.reduce((sum, r) => sum + r.TerminationError, 0);

  const trTot = document.getElementById('totalsRow');
  trTot.innerHTML = `
    <td>Total</td>
    <td>${totalDeadlock}</td>
    <td>${totalRuntimeException}</td>
    <td>${totalNoEntryMethod}</td>
    <td>${totalSingleThread}</td>
    <td>${totalTerminationError}</td>
    <td>0</td>
  `;
}


    function escapeHtml(unsafe){ return unsafe.replace(/[&<>\"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;" }[m])); }

    let currentSort = {key:null,desc:false};
    renderRows();

    document.getElementById('search').addEventListener('input', e=>{
      renderRows(e.target.value, currentSort.key, currentSort.desc);
    });

    document.querySelectorAll('th.sortable').forEach(th=>{
      th.addEventListener('click', ()=>{
        const key = th.dataset.key;
        const map = {Model:'Model', Deadlock:'Deadlock', RuntimeException:'RuntimeException', NoEntryMethod:'NoEntryMethod', SingleThread:'SingleThread', TerminationError:'TerminationError'};
        const mapped = map[key]||key;
        if(currentSort.key === mapped) currentSort.desc = !currentSort.desc; else {currentSort.key = mapped; currentSort.desc = false}
        renderRows(document.getElementById('search').value, currentSort.key, currentSort.desc);
      });
    });

    document.getElementById('downloadCsv').addEventListener('click', ()=>{
      const header = ['Model','Deadlock','Runtime Exception','No Entry Method','Single Thread','Termination Error','Race Condition'];
      const lines = [header.join(',')];
      rows.forEach(r=> lines.push([r.Model,r.Deadlock,r.RuntimeException,r.NoEntryMethod,r.SingleThread,r.TerminationError,0].join(',')));
      lines.push(['Total',totals.Deadlock,totals.RuntimeException,totals.NoEntryMethod,totals.SingleThread,totals.TerminationError,0].join(','));
      const blob = new Blob([lines.join('\n')], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'concurrency_summary.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    let chart = null;
    function renderChart(){
      const labels = rows.map(r=>r.Model);
      const datasets = [
        {label:'Deadlock', data:rows.map(r=>r.Deadlock)},
        {label:'Runtime Exception', data:rows.map(r=>r.RuntimeException)},
        {label:'No Entry Method', data:rows.map(r=>r.NoEntryMethod)},
        {label:'Single Thread', data:rows.map(r=>r.SingleThread)},
        {label:'Termination Error', data:rows.map(r=>r.TerminationError)}
      ];
      const ctx = document.getElementById('stackedChart');
      if(chart) chart.destroy();
      chart = new Chart(ctx, {
        type:'bar',
        data:{ labels, datasets },
        options:{
          plugins:{legend:{position:'top'}},
          responsive:true, maintainAspectRatio:false,
          scales: {
            x: { stacked: true, title:{display:false}},
            y: { stacked: true, beginAtZero:true, title:{display:true, text:'Count'} }
          }
        }
      });
    }

    const toggleBtn = document.getElementById('toggleChart');
    const tableWrap = document.getElementById('tableWrap');
    const chartWrap = document.getElementById('chartWrap');
    toggleBtn.addEventListener('click', ()=>{
      if(chartWrap.style.display === 'none'){ chartWrap.style.display='block'; tableWrap.style.display='none'; renderChart(); toggleBtn.textContent='Show Table'; }
      else { chartWrap.style.display='none'; tableWrap.style.display='block'; toggleBtn.textContent='Toggle Chart / Table'; }
    });

    document.addEventListener('keydown', e=>{ if(e.key==='/' && document.activeElement.id!=='search'){ e.preventDefault(); document.getElementById('search').focus(); }});
  </script>
</body>
</html>
